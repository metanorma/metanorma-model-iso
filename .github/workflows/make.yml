# Auto-generated by Cimas: Do not edit it manually!
# See https://github.com/metanorma/cimas
name: make

on:
  push:
    branches: [ master, main ]
    tags: [ v* ]
  pull_request:

jobs:
  make:
    name: Test on LutaML ${{ matrix.os }}
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ ubuntu-latest, windows-latest, macos-latest ]

    steps:
      - uses: actions/checkout@master

      # - name: Update Ubuntu
      #   if: matrix.os == 'ubuntu-latest'
      #   uses: nick-invision/retry@v1
      #   with:
      #     polling_interval_seconds: 5
      #     timeout_minutes: 5
      #     max_attempts: 3
      #     command: >
      #       sudo apt-get update -y

      - name: Use Ruby
        uses: actions/setup-ruby@v1
        with:
          ruby-version: 2.7

      - name: Install Grpahviz osx
        if: matrix.os == 'ubuntu-latest'
        run: brew install graphviz

      - name: Install Grpahviz ubuntu
        if: matrix.os == 'macos-latest'
        run: sudo apt-get install graphviz

      - name: Install graphviz windows
        uses: nick-invision/retry@v1
        if: matrix.os == 'windows-latest'
        with:
          polling_interval_seconds: 5
          timeout_minutes: 5
          max_attempts: 3
          command: choco install --no-progress graphviz --version 2.38.0.20190211

      - name: Install LutaML
        run: |
          gem install lutaml

      - if: matrix.os != 'windows-latest'
        run:  make clean all

      - if: matrix.os == 'windows-latest'
        shell: cmd
        run: make clean all

  # tests-passed:
  #   needs: make
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Trigger tests passed event
  #       uses: Sibz/github-status-action@v1
  #       with:
  #         authToken: ${{ secrets.GITHUB_TOKEN }}
  #         context: 'tests-passed-successfully'
  #         description: 'Tests passed successfully'
  #         state: 'success'
  #         sha: ${{ github.event.pull_request.head.sha || github.sha }}
